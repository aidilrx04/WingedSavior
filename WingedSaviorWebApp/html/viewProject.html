<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Project - Winged Saviors</title>
    <link href="styles.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
      /* Project Detail Section */
      .project-detail-section {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 800px;
        height: 75vh;
        overflow-y: auto;
        max-height: 90vh;
        margin: 100px auto 20px;
      }

      .project-detail-section h2 {
        color: #2f3645;
        text-align: center;
        margin-bottom: 20px;
        font-size: 2em;
      }

      .project-info {
        margin-bottom: 20px;
      }

      .project-info p {
        font-size: 24px;
        margin: 10px 0;
      }

      .start-stop-container {
        text-align: center;
      }

      .start-stop-container img {
        cursor: pointer;
        width: 250px;
        border-radius: 100%;
        transition: transform 0.3s ease;
      }

      .start-stop-container img.animate {
        transform: scale(1.1);
        transition: transform 0.3s ease;
      }
    </style>
  </head>
  <body>
    <header class="fixed-header">
      <div class="header-content">
        <a href="projectList.html" class="back-button">
          <i class="ph ph-arrow-left"></i
        ></a>
        <img src="img/logo.png" alt="Winged Saviors Logo" class="logo-img" />
        <div class="notification-container">
          <a href="#" class="notification-icon" onclick="togglePopup(event)">
            <i class="ph ph-bell"></i>
          </a>
          <div class="notification-popup" id="notificationPopup">
            <!-- Notification content goes here -->
            <p>This is a notification popup!</p>
          </div>
        </div>
      </div>
    </header>

    <main class="background-image">
      <section class="container project-detail-section">
        <h2>Project Details</h2>
        <div class="project-info">
          <p>
            <strong>Project Name:</strong>
            <span id="projectName">Project Alpha</span>
          </p>
          <p>
            <strong>Project Coordinate:</strong>
            <span id="projectCoordinate">128cm</span>
          </p>
          <p>
            <strong>Drone Detection:</strong>
            <span id="droneDetection">People</span>
          </p>
          <br /><br />
          <button
            type="submit"
            class="button"
            id="edit-button"
            onClick="location.href='editProject.html'"
          >
            Edit Project
          </button>
        </div>
      </section>
    </main>
    <footer>
      <nav class="bottom-nav">
        <ul>
          <li>
            <a href="home.html">
              <i class="ph ph-house"></i><br />
              <span class="nav-name">Home</span>
            </a>
          </li>
          <li>
            <a href="liveFeed.html">
              <i class="ph ph-video-camera"></i><br />
              <span class="nav-name">Live Feed</span>
            </a>
          </li>
          <li>
            <a href="profile.html">
              <i class="ph ph-user"></i><br />
              <span class="nav-name">Profile</span>
            </a>
          </li>
        </ul>
      </nav>
    </footer>

    <script>
      let isStarted = false;

      function toggleStartStop() {
        const startStopImage = document.getElementById("startStopImage");
        startStopImage.classList.add("animate");
        setTimeout(() => {
          if (isStarted) {
            startStopImage.src = "img/btnOff.png";
            isStarted = false;
          } else {
            startStopImage.src = "img/btnOn.png";
            isStarted = true;
          }
          startStopImage.classList.remove("animate");
        }, 300); // duration matches the CSS animation
      }

      // Toggle notification popup visibility
      function togglePopup(event) {
        event.preventDefault();
        var popup = document.getElementById("notificationPopup");
        popup.classList.toggle("show");
      }
    </script>
    <script type="module">
      import { api } from "./conn.js";
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get("project");
        console.log("123");
        if (projectId) {
          loadProjectDetails(projectId);
        }
      });

      async function loadProjectDetails(projectId) {
        try {
          const res = await fetch(api("/check_project?project=" + projectId));

          if (res.status !== 200) {
            alert("Project not found!");
            window.location.href = "projectList.html";
            return;
          }

          const data = await res.json();
          console.log(data);

          document.querySelector("#projectName").textContent = data.name;
          document.querySelector("#projectCoordinate").textContent =
            data.coordinate;
          document.querySelector("#droneDetection").textContent = data.detect;
          document.querySelector("#edit-button").onclick = () =>
            (window.location.href = "editProject.html?project=" + projectId);
        } catch (err) {
          console.error(err);
        }
      }
    </script>
  </body>
</html>
